{{- if .Values.postgresql.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "credential-showcase.fullname" . }}-postgresql-config
  namespace: {{ .Values.global.namespaceOverride | default .Release.Namespace }}
  labels:
    {{- include "credential-showcase.labels" . | nindent 4 }}
data:
  postgresql.conf: |
    {{- .Values.postgresql.primary.extendedConfiguration | nindent 4 }}
---
{{- end }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "credential-showcase.fullname" . }}
  namespace: {{ .Values.global.namespaceOverride | default .Release.Namespace }}
  labels:
    {{- include "credential-showcase.labels" . | nindent 4 }}
data:
  {{- if .Values.postgresql.enabled }}
  DB_HOST: {{ .Release.Name }}-postgresql
  DB_PORT: "{{ .Values.postgresql.primary.service.ports.postgresql }}"
  {{- end }}
  {{- if .Values.rabbitmq.enabled }}
  RABBITMQ_HOST: {{ .Release.Name }}-rabbitmq
  RABBITMQ_PORT: "{{ .Values.rabbitmq.service.port }}"
  RABBITMQ_MANAGEMENT_PORT: "{{ .Values.rabbitmq.service.managerPort }}"
  {{- end }}
  {{- if .Values.configMapData }}
  {{- toYaml .Values.configMapData | nindent 2 }}
  {{- end }}